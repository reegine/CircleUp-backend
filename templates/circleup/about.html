<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>CircleUP ‚Äì About</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
:root{
  --bg:#f5f5f5;
  --ink:#333;
  --card:#fff;
  --line:#e0e0e0;
  --line-soft:#eee;
  --muted:#888;
  --accent:#e59d2c;
  --sidebar-bg:#f8f8f8;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg);
  color:var(--ink);
  display:flex;
  overflow:hidden;
}

/* Layout */
.layout{display:flex;min-height:100vh;overflow:hidden;width:100%;margin-left:260px}
.main{flex:1;display:flex;gap:0;padding:0;background:var(--bg);overflow:hidden}
.content{
  flex:1;
  min-width:0;
  overflow-y:auto;
  padding:0;
  background:#fff;
}

/* Left Rail (Communities) */
.left-rail{
  width:200px;
  background:#fff;
  border-right:1px solid var(--line-soft);
  padding:12px 10px;
  overflow-y:auto;
}
.left-rail::-webkit-scrollbar{width:8px}
.left-rail::-webkit-scrollbar-thumb{background:#e4e4e4;border-radius:8px}
.rail-item{
  display:flex;
  align-items:center;
  gap:10px;
  margin:8px 4px;
  padding:10px;
  border-radius:12px;
  cursor:pointer;
  transition:all .2s;
}
.rail-item:hover{
  background:#f5f5f5;
}
.rail-item.active{
  outline:2px solid var(--accent);
  background:#fff3e0;
}
.rail-thumb{
  width:56px;
  height:56px;
  border-radius:12px;
  object-fit:cover;
  flex-shrink:0;
}
.rail-info{
  flex:1;
  min-width:0;
}
.rail-label{
  font-weight:600;
  font-size:14px;
  color:#222;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.rail-count{
  font-size:11px;
  color:#666;
  margin-top:2px;
}

/* Hero Section */
.hero-section{
  position:relative;
  height:400px;
  overflow:hidden;
}

.hero-bg{
  width:100%;
  height:100%;
  object-fit:cover;
}

.hero-overlay{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  background:linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%);
  padding:40px 48px;
}

.hero-content{
  display:flex;
  align-items:flex-end;
  gap:24px;
}

.community-avatar{
  width:140px;
  height:140px;
  border-radius:20px;
  object-fit:cover;
  border:4px solid #fff;
  background:#ddd;
  flex-shrink:0;
}

.hero-info{
  flex:1;
  color:#fff;
  padding-bottom:10px;
}

.community-title{
  font-size:36px;
  font-weight:700;
  margin:0 0 8px;
  text-shadow:0 2px 8px rgba(0,0,0,0.4);
}

.community-stats{
  font-size:16px;
  color:rgba(255,255,255,0.95);
  text-shadow:0 1px 4px rgba(0,0,0,0.4);
}

.community-stats .online{
  color:#4caf50;
}

/* Action Buttons */
.action-buttons{
  display:flex;
  gap:12px;
  align-items:flex-end;
  padding-bottom:10px;
}

.btn-action{
  padding:12px 28px;
  border-radius:30px;
  border:none;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all .2s;
  font-family:'Poppins',sans-serif;
  display:flex;
  align-items:center;
  gap:8px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
}

.btn-primary{
  background:var(--accent);
  color:#fff;
}

.btn-primary:hover{
  background:#d18b1f;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(229,157,44,0.4);
}

.btn-secondary{
  background:#555;
  color:#fff;
}

.btn-secondary:hover{
  background:#444;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}

.btn-icon{
  background:#fff;
  color:#333;
  width:50px;
  height:50px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:0;
  font-size:20px;
}

.btn-icon:hover{
  background:#f5f5f5;
  transform:translateY(-2px);
}

.btn-danger{
  background:#dc3545;
  color:#fff;
}

.btn-danger:hover{
  background:#c82333;
}

/* Bio Section */
.bio-section{
  padding:48px;
  max-width:900px;
}

.bio-section h3{
  font-size:22px;
  font-weight:700;
  margin:0 0 24px;
  color:#222;
}

.bio-content{
  font-size:15px;
  line-height:1.8;
  color:#444;
}

.bio-item{
  margin-bottom:12px;
}

.bio-footer{
  margin-top:32px;
  padding-top:24px;
  border-top:1px solid var(--line-soft);
  color:var(--muted);
  font-size:14px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.bio-footer strong{
  color:#333;
}

.delete-section{
  margin-top:40px;
  padding-top:32px;
  border-top:2px solid var(--line-soft);
}

.delete-section h4{
  font-size:18px;
  color:#dc3545;
  margin-bottom:12px;
}

.delete-section p{
  color:#666;
  margin-bottom:20px;
}

/* Right Sidebar */
.right-sidebar{
  flex:0 0 340px;
  width:340px;
  height:100vh;
  overflow-y:auto;
  background:var(--sidebar-bg);
  border-left:1px solid var(--line-soft);
  padding:24px;
  position:sticky;
  top:0;
}

.sidebar-header{
  text-align:center;
  margin-bottom:28px;
}

.sidebar-cover{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:16px;
  background:#eaeaea;
  display:block;
  margin-bottom:16px;
}

.sidebar-title{
  font-weight:700;
  font-size:18px;
  margin-bottom:6px;
  color:#111;
}

.sidebar-stats{
  font-size:13px;
  color:var(--muted);
}

/* Menu */
.sidebar-menu{
  list-style:none;
  margin:0 0 28px 0;
  padding:0;
}

.sidebar-menu-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:14px 16px;
  border-radius:12px;
  text-decoration:none;
  color:#333;
  font-weight:600;
  font-size:15px;
  background:transparent;
  transition:background .2s;
  margin-bottom:6px;
}

.sidebar-menu-item:hover{
  background:rgba(0,0,0,0.05);
}

.sidebar-menu-item.active{
  background:var(--accent);
  color:#fff;
}

.menu-icon{
  width:20px;
  height:20px;
  flex-shrink:0;
}

/* Sections */
.sidebar-section{
  margin-top:24px;
}

.section-toggle{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  color:#666;
  padding:10px 6px;
  font-weight:700;
  font-size:12px;
  letter-spacing:0.5px;
  text-transform:uppercase;
  user-select:none;
}

.section-toggle::before{
  content:'‚ñº';
  font-size:10px;
  transition:transform .2s;
}

.section-toggle.collapsed::before{
  transform:rotate(-90deg);
}

.section-list{
  margin-top:10px;
}

.channel-item,
.event-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-radius:10px;
  text-decoration:none;
  color:#333;
  background:transparent;
  margin-bottom:6px;
  transition:background .2s;
  font-weight:500;
  font-size:14px;
}

.channel-item:hover,
.event-item:hover{
  background:rgba(0,0,0,0.05);
}

.channel-item.active{
  background:rgba(229,157,44,0.15);
  color:var(--accent);
  font-weight:600;
}

.item-icon{
  width:18px;
  height:18px;
  flex-shrink:0;
  fill:currentColor;
}

/* Modals */
.modal-overlay{
  display:none;
  position:fixed;
  top:0;
  left:0;
  right:0;
  bottom:0;
  background:rgba(0,0,0,0.6);
  z-index:10000;
  align-items:center;
  justify-content:center;
}

.modal-overlay.active{
  display:flex;
}

.modal-content{
  background:#fff;
  border-radius:20px;
  width:90%;
  max-width:540px;
  max-height:90vh;
  overflow-y:auto;
  box-shadow:0 10px 40px rgba(0,0,0,0.3);
  animation:modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn{
  from{opacity:0;transform:translateY(30px)scale(0.95)}
  to{opacity:1;transform:translateY(0)scale(1)}
}

.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:24px 28px;
  border-bottom:1px solid var(--line-soft);
}

.modal-title{
  font-size:22px;
  font-weight:700;
  color:#222;
  display:flex;
  align-items:center;
  gap:12px;
}

.modal-close{
  background:none;
  border:none;
  font-size:28px;
  cursor:pointer;
  color:#666;
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
  transition:all .2s;
}

.modal-close:hover{
  background:#f0f0f0;
  color:#333;
}

.modal-body{
  padding:28px;
}

.modal-footer{
  padding:20px 28px;
  border-top:1px solid var(--line-soft);
  display:flex;
  justify-content:flex-end;
  gap:12px;
}

/* Forms */
.form-group{
  margin-bottom:24px;
}

.form-label{
  display:block;
  font-weight:600;
  font-size:14px;
  margin-bottom:10px;
  color:#333;
}

.form-input,
.form-textarea{
  width:100%;
  padding:14px 18px;
  border:1px solid var(--line);
  border-radius:10px;
  font-family:'Poppins',sans-serif;
  font-size:14px;
  transition:all .2s;
}

.form-input:focus,
.form-textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(229,157,44,0.1);
}

.form-textarea{
  resize:vertical;
  min-height:140px;
}

/* Toggle */
.toggle-container{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:18px;
  background:#f9f9f9;
  border-radius:12px;
  margin-bottom:14px;
}

.toggle-label{
  font-size:14px;
  font-weight:600;
  color:#333;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.toggle-description{
  font-size:12px;
  color:#666;
  font-weight:400;
}

.toggle-switch{
  position:relative;
  width:52px;
  height:28px;
  background:#ccc;
  border-radius:28px;
  cursor:pointer;
  transition:background .3s;
}

.toggle-switch.active{
  background:var(--accent);
}

.toggle-switch::after{
  content:'';
  position:absolute;
  top:3px;
  left:3px;
  width:22px;
  height:22px;
  background:#fff;
  border-radius:50%;
  transition:left .3s;
}

.toggle-switch.active::after{
  left:27px;
}

/* Image Upload */
.image-upload-area{
  position:relative;
  width:100%;
  height:220px;
  border:2px dashed var(--line);
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all .2s;
  overflow:hidden;
  background:#f9f9f9;
}

.image-upload-area:hover{
  border-color:var(--accent);
  background:#fff;
}

.image-upload-icon{
  font-size:52px;
  color:#999;
}

.image-preview{
  width:100%;
  height:100%;
  object-fit:cover;
}

.avatar-upload-area{
  position:relative;
  width:130px;
  height:130px;
  border:2px dashed var(--line);
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all .2s;
  overflow:hidden;
  background:#f9f9f9;
  margin-bottom:20px;
}

.avatar-upload-area:hover{
  border-color:var(--accent);
}

/* Copy Link */
.copy-link-container{
  display:flex;
  gap:10px;
  align-items:center;
}

.copy-input{
  flex:1;
  padding:14px 18px;
  border:1px solid var(--line);
  border-radius:10px;
  font-size:14px;
  background:#f9f9f9;
}

.btn-copy{
  padding:14px 28px;
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
  transition:all .2s;
  white-space:nowrap;
}

.btn-copy:hover{
  background:#d18b1f;
}

/* Confirmation */
.confirm-dialog{
  text-align:center;
  padding:24px;
}

.confirm-icon{
  font-size:56px;
  margin-bottom:20px;
}

.confirm-message{
  font-size:17px;
  color:#666;
  line-height:1.6;
  margin-bottom:28px;
}

/* Buttons */
.btn-modal{
  padding:13px 28px;
  border:none;
  border-radius:10px;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
  transition:all .2s;
  font-family:'Poppins',sans-serif;
}

.btn-modal-primary{
  background:var(--accent);
  color:#fff;
}

.btn-modal-primary:hover{
  background:#d18b1f;
}

.btn-modal-danger{
  background:#dc3545;
  color:#fff;
}

.btn-modal-danger:hover{
  background:#c82333;
}

.btn-modal-secondary{
  background:#6c757d;
  color:#fff;
}

.btn-modal-secondary:hover{
  background:#5a6268;
}

.muted{
  color:#9aa6b2;
  font-size:13px;
  padding:12px 16px;
  font-style:italic;
}

@media (max-width:1024px){
  .layout{margin-left:0}
  .left-rail,
  .right-sidebar{display:none}
  .content{padding:0}
  .hero-section{height:300px}
  .hero-overlay{padding:24px}
  .hero-content{flex-wrap:wrap}
  .community-avatar{width:100px;height:100px}
  .community-title{font-size:28px}
  .action-buttons{width:100%;justify-content:flex-start}
  .bio-section{padding:28px}
}
  </style>
</head>
<body>
  <div class="layout">
    <!-- Left Rail: Communities List -->
    <aside class="left-rail" id="leftRail">
      <div style="color:#888;padding:6px">Loading communities...</div>
    </aside>

    <main class="main">
      <section class="content">
        <!-- Hero Section -->
        <div class="hero-section">
          <img id="heroBg" class="hero-bg" alt="Community Cover"/>
          
          <div class="hero-overlay">
            <div class="hero-content">
              <img id="heroAvatar" class="community-avatar" alt="Community Avatar"/>
              
              <div class="hero-info">
                <h1 id="heroName" class="community-title">Community Name</h1>
                <div id="heroStats" class="community-stats">
                  <span id="memberCount">0</span> Members, <span class="online" id="onlineCount">0</span> Online
                </div>
              </div>
              
              <div class="action-buttons">
                <button class="btn-action btn-icon" onclick="openAddChannelModal()" title="Add Channel">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 5v14M5 12h14"/>
                  </svg>
                </button>
                <button class="btn-action btn-primary" onclick="openEditBioModal()">
                  üëë Edit Bio
                </button>
                <button class="btn-action btn-secondary" id="joinedBtn" onclick="openLeaveConfirmModal()">
                  Joined
                </button>
                <button class="btn-action btn-icon" onclick="openShareLinkModal()" title="Share">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
                    <polyline points="16 6 12 2 8 6"></polyline>
                    <line x1="12" y1="2" x2="12" y2="15"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Bio Section -->
        <article class="bio-section">
          <h3>About</h3>
          <div id="bioContent" class="bio-content">
            <p>Community description will appear here.</p>
          </div>
          
          <div class="bio-footer">
            <div>Created by <strong id="createdBy">@Creator</strong></div>
            <div>
              <span id="locationInfo">üìç Location</span> ‚Ä¢ 
              <span id="createdDate">üìÖ Created Date</span>
            </div>
          </div>

          <!-- Delete Community Section (Admin Only) -->
          <div class="delete-section" id="deleteSection" style="display:none">
            <h4>‚ö†Ô∏è Danger Zone</h4>
            <p>Once you delete a community, there is no going back. Please be certain.</p>
            <button class="btn-action btn-danger" onclick="openDeleteCommunityModal()">
              Delete Community
            </button>
          </div>
        </article>
      </section>

      <!-- Right Sidebar -->
      <aside class="right-sidebar">
        <div class="sidebar-header">
          <img id="sidebarCover" class="sidebar-cover" alt="Community banner" data-rs="image">
          <div id="sidebarName" class="sidebar-title" data-rs="name">Community</div>
          <div id="sidebarStats" class="sidebar-stats" data-rs="counts"></div>
        </div>
        
        <ul class="sidebar-menu">
          <li>
            <a href="#" class="sidebar-menu-item active" onclick="return false">
              <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
              </svg>
              <span>About</span>
            </a>
          </li>
          <li>
            <a href="#" class="sidebar-menu-item" id="eventInfoLink">
              <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
              </svg>
              <span>Event Info</span>
            </a>
          </li>
          <li>
            <a href="#" class="sidebar-menu-item" id="feedsLink">
              <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
              <span>Feeds</span>
            </a>
          </li>
          <li>
            <a href="#" class="sidebar-menu-item" id="membersLink">
              <svg class="menu-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
              <span>Members</span>
            </a>
          </li>
        </ul>
        
        <div class="sidebar-section">
          <div class="section-toggle" onclick="toggleSection('channels')">Channels</div>
          <div id="channels-list" class="section-list"></div>
        </div>
        
        <div class="sidebar-section">
          <div class="section-toggle" onclick="toggleSection('events')">Events</div>
          <div id="events-list" class="section-list"></div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Modal: Add Channel -->
  <div id="addChannelModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚ûï Add Channel</div>
        <button class="modal-close" onclick="closeModal('addChannelModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <form id="addChannelForm" onsubmit="event.preventDefault(); addChannel();">
          <div class="form-group">
            <label class="form-label">Channel Name</label>
            <input type="text" class="form-input" id="channelName" placeholder="e.g., general-chat" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Description (Optional)</label>
            <textarea class="form-textarea" id="channelDescription" placeholder="Describe this channel..." style="min-height:100px"></textarea>
          </div>
          
          <div class="toggle-container">
            <div class="toggle-label">
              <span>üîí Restricted Channel</span>
              <span class="toggle-description">Only admins can view this channel</span>
            </div>
            <div class="toggle-switch" id="restrictedToggle" onclick="toggleSwitch('restrictedToggle')"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-modal btn-modal-secondary" onclick="closeModal('addChannelModal')">Cancel</button>
        <button class="btn-modal btn-modal-primary" onclick="addChannel()">Add Channel</button>
      </div>
    </div>
  </div>

  <!-- Modal: Edit Bio -->
  <div id="editBioModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚úèÔ∏è Edit Community Bio</div>
        <button class="modal-close" onclick="closeModal('editBioModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <form id="editBioForm" onsubmit="event.preventDefault(); saveBio();">
          <div class="form-group">
            <label class="form-label">Banner Image</label>
            <div class="image-upload-area" onclick="document.getElementById('bannerInput').click()">
              <img id="bannerPreview" class="image-preview" style="display:none" alt="Banner">
              <div id="bannerPlaceholder">
                <div class="image-upload-icon">üì∑</div>
              </div>
            </div>
            <input type="file" id="bannerInput" accept="image/*" style="display:none" onchange="previewImage('bannerInput', 'bannerPreview', 'bannerPlaceholder')">
          </div>

          <div class="form-group">
            <label class="form-label">Avatar</label>
            <div class="avatar-upload-area" onclick="document.getElementById('avatarInput').click()">
              <img id="avatarPreview" class="image-preview" style="display:none" alt="Avatar">
              <div id="avatarPlaceholder">
                <div class="image-upload-icon" style="font-size:36px">üì∑</div>
              </div>
            </div>
            <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="previewImage('avatarInput', 'avatarPreview', 'avatarPlaceholder')">
          </div>
          
          <div class="form-group">
            <label class="form-label">Community Name</label>
            <input type="text" class="form-input" id="communityName" placeholder="Community name" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="communityBio" placeholder="Tell us about your community..."></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="communityLocation" placeholder="e.g., Jakarta, Indonesia">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-modal btn-modal-secondary" onclick="closeModal('editBioModal')">Cancel</button>
        <button class="btn-modal btn-modal-primary" onclick="saveBio()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Modal: Leave Community -->
  <div id="leaveConfirmModal" class="modal-overlay">
    <div class="modal-content" style="max-width:440px">
      <div class="modal-header">
        <div class="modal-title">Leave Community</div>
        <button class="modal-close" onclick="closeModal('leaveConfirmModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="confirm-dialog">
          <div class="confirm-icon">‚ö†Ô∏è</div>
          <div class="confirm-message">
            Are you sure you want to leave this community? You'll need an invite to rejoin.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-modal btn-modal-secondary" onclick="closeModal('leaveConfirmModal')">Cancel</button>
        <button class="btn-modal btn-modal-danger" onclick="leaveCommunity()">Leave</button>
      </div>
    </div>
  </div>

  <!-- Modal: Delete Community -->
  <div id="deleteCommunityModal" class="modal-overlay">
    <div class="modal-content" style="max-width:440px">
      <div class="modal-header">
        <div class="modal-title">Delete Community</div>
        <button class="modal-close" onclick="closeModal('deleteCommunityModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="confirm-dialog">
          <div class="confirm-icon">üóëÔ∏è</div>
          <div class="confirm-message">
            This action cannot be undone. This will permanently delete the community, all channels, posts, and events.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-modal btn-modal-secondary" onclick="closeModal('deleteCommunityModal')">Cancel</button>
        <button class="btn-modal btn-modal-danger" onclick="deleteCommunity()">Delete Permanently</button>
      </div>
    </div>
  </div>

  <!-- Modal: Share Link -->
  <div id="shareLinkModal" class="modal-overlay">
    <div class="modal-content" style="max-width:520px">
      <div class="modal-header">
        <div class="modal-title">üîó Share Invite Link</div>
        <button class="modal-close" onclick="closeModal('shareLinkModal')">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="copy-link-container">
          <input type="text" class="copy-input" id="inviteLink" readonly value="">
          <button class="btn-copy" onclick="copyInviteLink()">Copy</button>
        </div>
      </div>
    </div>
  </div>

<script>
// ===== Configuration =====
const API_BASE = typeof localStorage !== 'undefined' && localStorage.getItem("API_BASE") || "http://127.0.0.1:8000/api";
const ACCESS = typeof localStorage !== 'undefined' && localStorage.getItem("access");
if (!ACCESS) {
  window.location.href = "/login/";
}
const H = { 
  Authorization: `Bearer ${ACCESS}`,
  "Content-Type": "application/json"
};

// Get community ID from URL
const params = new URLSearchParams(location.search);
const COMMUNITY_ID = params.get("community");

if (!COMMUNITY_ID) {
  alert("Community ID is required");
  window.location.href = "/home/";
}

// Global state
let CURRENT_COMMUNITY = null;
let USER_ROLE = null;
let ALL_COMMUNITIES = [];
let ALL_CHANNELS = [];
let ALL_EVENTS = [];

// ===== Utility Functions =====
const absUrl = (u) => {
  if (!u) return "";
  if (u.startsWith("http")) return u;
  const root = API_BASE.replace(/\/api\/?$/, "");
  return `${root}${u.startsWith("/") ? "" : "/"}${u}`;
};

function formatDate(dateStr) {
  if (!dateStr) return "";
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
}

// ===== Modal Functions =====
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) modal.classList.add('active');
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) modal.classList.remove('active');
}

function openAddChannelModal() {
  if (USER_ROLE !== 'admin') {
    alert('Only admins can add channels');
    return;
  }
  document.getElementById('channelName').value = '';
  document.getElementById('channelDescription').value = '';
  document.getElementById('restrictedToggle').classList.remove('active');
  openModal('addChannelModal');
}

function openEditBioModal() {
  if (USER_ROLE !== 'admin') {
    alert('Only admins can edit community bio');
    return;
  }
  
  // Pre-fill form with current data
  document.getElementById('communityName').value = CURRENT_COMMUNITY.name || '';
  document.getElementById('communityBio').value = CURRENT_COMMUNITY.description || '';
  document.getElementById('communityLocation').value = CURRENT_COMMUNITY.location || '';
  
  // Show current images
  if (CURRENT_COMMUNITY.background_banner) {
    const bannerPreview = document.getElementById('bannerPreview');
    const bannerPlaceholder = document.getElementById('bannerPlaceholder');
    bannerPreview.src = absUrl(CURRENT_COMMUNITY.background_banner);
    bannerPreview.style.display = 'block';
    bannerPlaceholder.style.display = 'none';
  }
  
  if (CURRENT_COMMUNITY.profile_pic) {
    const avatarPreview = document.getElementById('avatarPreview');
    const avatarPlaceholder = document.getElementById('avatarPlaceholder');
    avatarPreview.src = absUrl(CURRENT_COMMUNITY.profile_pic);
    avatarPreview.style.display = 'block';
    avatarPlaceholder.style.display = 'none';
  }
  
  openModal('editBioModal');
}

function openLeaveConfirmModal() {
  openModal('leaveConfirmModal');
}

function openDeleteCommunityModal() {
  openModal('deleteCommunityModal');
}

function openShareLinkModal() {
  const link = `${window.location.origin}/about/?community=${COMMUNITY_ID}`;
  document.getElementById('inviteLink').value = link;
  openModal('shareLinkModal');
}

function toggleSwitch(id) {
  const toggle = document.getElementById(id);
  if (toggle) {
    toggle.classList.toggle('active');
  }
}

function toggleSection(section) {
  const toggle = event.currentTarget;
  const list = toggle.nextElementSibling;
  toggle.classList.toggle('collapsed');
  if (list) {
    list.style.display = list.style.display === 'none' ? 'block' : 'none';
  }
}

function previewImage(inputId, previewId, placeholderId) {
  const input = document.getElementById(inputId);
  const preview = document.getElementById(previewId);
  const placeholder = document.getElementById(placeholderId);
  
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      preview.style.display = 'block';
      placeholder.style.display = 'none';
    };
    reader.readAsDataURL(input.files[0]);
  }
}

function copyInviteLink() {
  const input = document.getElementById('inviteLink');
  input.select();
  document.execCommand('copy');
  
  const btn = event.target;
  const originalText = btn.textContent;
  btn.textContent = 'Copied!';
  setTimeout(() => {
    btn.textContent = originalText;
  }, 2000);
}

// ===== API Functions =====
async function fetchCommunityDetails() {
  try {
    const response = await fetch(`${API_BASE}/communities/${COMMUNITY_ID}/`, {
      headers: H
    });
    
    if (!response.ok) throw new Error('Failed to fetch community');
    
    const data = await response.json();
    CURRENT_COMMUNITY = data;
    USER_ROLE = data.user_role;
    
    renderCommunityDetails(data);
  } catch (error) {
    console.error('Error fetching community:', error);
    alert('Failed to load community details');
  }
}

async function fetchAllCommunities() {
  try {
    const response = await fetch(`${API_BASE}/home/`, { headers: H });
    if (!response.ok) throw new Error('Failed to fetch communities');
    
    const data = await response.json();
    ALL_COMMUNITIES = data.joined_communities || [];
    renderLeftRail(ALL_COMMUNITIES);
  } catch (error) {
    console.error('Error fetching communities:', error);
  }
}

async function fetchChannels() {
  try {
    const response = await fetch(`${API_BASE}/channels/`, { headers: H });
    if (!response.ok) throw new Error('Failed to fetch channels');
    
    const data = await response.json();
    ALL_CHANNELS = Array.isArray(data) ? data : (data.results || []);
    
    // Filter channels for current community
    const communityChannels = ALL_CHANNELS.filter(ch => 
      String(ch.community) === String(COMMUNITY_ID)
    );
    
    renderChannels(communityChannels);
  } catch (error) {
    console.error('Error fetching channels:', error);
  }
}

async function fetchEvents() {
  try {
    const response = await fetch(`${API_BASE}/events/`, { headers: H });
    if (!response.ok) throw new Error('Failed to fetch events');
    
    const data = await response.json();
    ALL_EVENTS = Array.isArray(data) ? data : (data.results || []);
    
    // Filter events for current community
    const communityEvents = ALL_EVENTS.filter(ev => 
      ev.community && String(ev.community.id) === String(COMMUNITY_ID)
    );
    
    renderEvents(communityEvents);
  } catch (error) {
    console.error('Error fetching events:', error);
  }
}

async function addChannel() {
  const name = document.getElementById('channelName').value.trim();
  const description = document.getElementById('channelDescription').value.trim();
  const isRestricted = document.getElementById('restrictedToggle').classList.contains('active');
  
  if (!name) {
    alert('Please enter a channel name');
    return;
  }
  
  try {
    const response = await fetch(`${API_BASE}/communities/${COMMUNITY_ID}/add_channel/`, {
      method: 'POST',
      headers: H,
      body: JSON.stringify({
        name: name,
        description: description,
        is_restricted: isRestricted
      })
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.detail || 'Failed to add channel');
    }
    
    alert('Channel added successfully!');
    closeModal('addChannelModal');
    await fetchChannels();
  } catch (error) {
    console.error('Error adding channel:', error);
    alert(error.message);
  }
}

async function saveBio() {
  const name = document.getElementById('communityName').value.trim();
  const bio = document.getElementById('communityBio').value.trim();
  const location = document.getElementById('communityLocation').value.trim();
  const bannerFile = document.getElementById('bannerInput').files[0];
  const avatarFile = document.getElementById('avatarInput').files[0];
  
  if (!name) {
    alert('Please enter a community name');
    return;
  }
  
  try {
    const formData = new FormData();
    formData.append('name', name);
    if (bio) formData.append('description', bio);
    if (location) formData.append('location', location);
    if (bannerFile) formData.append('background_banner', bannerFile);
    if (avatarFile) formData.append('profile_pic', avatarFile);
    
    const response = await fetch(`${API_BASE}/communities/${COMMUNITY_ID}/`, {
      method: 'PATCH',
      headers: {
        Authorization: `Bearer ${ACCESS}`
      },
      body: formData
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.detail || 'Failed to update community');
    }
    
    alert('Community updated successfully!');
    closeModal('editBioModal');
    await fetchCommunityDetails();
  } catch (error) {
    console.error('Error updating community:', error);
    alert(error.message);
  }
}

async function leaveCommunity() {
  try {
    const response = await fetch(`${API_BASE}/communities/${COMMUNITY_ID}/leave/`, {
      method: 'POST',
      headers: H
    });
    
    if (!response.ok) throw new Error('Failed to leave community');
    
    alert('You have left the community');
    closeModal('leaveConfirmModal');
    window.location.href = '/home/';
  } catch (error) {
    console.error('Error leaving community:', error);
    alert('Failed to leave community');
  }
}

async function deleteCommunity() {
  try {
    const response = await fetch(`${API_BASE}/communities/${COMMUNITY_ID}/`, {
      method: 'DELETE',
      headers: H
    });
    
    if (!response.ok) throw new Error('Failed to delete community');
    
    alert('Community deleted successfully');
    closeModal('deleteCommunityModal');
    window.location.href = '/home/';
  } catch (error) {
    console.error('Error deleting community:', error);
    alert('Failed to delete community');
  }
}

// ===== Render Functions =====
function renderCommunityDetails(community) {
  // Hero section
  document.getElementById('heroBg').src = absUrl(community.background_banner) || 'https://via.placeholder.com/1200x400?text=Community+Banner';
  document.getElementById('heroAvatar').src = absUrl(community.profile_pic) || 'https://via.placeholder.com/140?text=Avatar';
  document.getElementById('heroName').textContent = community.name || 'Community';
  document.getElementById('memberCount').textContent = community.member_count || 0;
  document.getElementById('onlineCount').textContent = community.online_count || 0;
  
  // Bio section
  const bioContent = document.getElementById('bioContent');
  if (community.description) {
    const lines = community.description.split('\n');
    bioContent.innerHTML = lines.map(line => `<p class="bio-item">${line}</p>`).join('');
  } else {
    bioContent.innerHTML = '<p class="bio-item">No description available.</p>';
  }
  
  // Footer info
  const creator = community.created_by;
  document.getElementById('createdBy').textContent = creator ? `@${creator.username || creator.email}` : '@Unknown';
  document.getElementById('locationInfo').textContent = community.location ? `üìç ${community.location}` : 'üìç Location not set';
  document.getElementById('createdDate').textContent = `üìÖ Created ${formatDate(community.created_at)}`;
  
  // Show delete section only for admins
  if (USER_ROLE === 'admin') {
    document.getElementById('deleteSection').style.display = 'block';
  }
  
  // Update sidebar
  document.getElementById('sidebarCover').src = absUrl(community.background_banner || community.profile_pic) || 'https://via.placeholder.com/340x140';
  document.getElementById('sidebarName').textContent = community.name || 'Community';
  document.getElementById('sidebarStats').textContent = `${community.member_count || 0} Members, ${community.online_count || 0} Online`;
  
  // Update sidebar links
  updateSidebarLinks();
}

function renderLeftRail(communities) {
  const rail = document.getElementById('leftRail');
  if (!rail) return;
  
  if (!communities || communities.length === 0) {
    rail.innerHTML = '<div style="color:#888;padding:6px">No communities joined</div>';
    return;
  }
  
  rail.innerHTML = communities.map(comm => {
    const isActive = String(comm.id) === String(COMMUNITY_ID);
    return `
      <div class="rail-item ${isActive ? 'active' : ''}" 
           data-comm-id="${comm.id}"
           onclick="navigateToCommunity('${comm.id}')">
        <img class="rail-thumb" 
             src="${absUrl(comm.profile_pic || comm.background_banner) || 'https://via.placeholder.com/56'}" 
             alt="${comm.name || 'Community'}">
        <div class="rail-info">
          <div class="rail-label">${comm.name || 'Community'}</div>
          <div class="rail-count">${comm.member_count || 0} members</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderChannels(channels) {
  const box = document.getElementById('channels-list');
  if (!box) return;
  
  if (!channels || channels.length === 0) {
    box.innerHTML = '<div class="muted">No channels</div>';
    return;
  }
  
  box.innerHTML = channels.map(ch => `
    <a href="/chat/?community=${COMMUNITY_ID}&channel=${ch.id}" class="channel-item" data-channel="${ch.id}">
      <svg class="item-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
      </svg>
      <span>${ch.name}</span>
    </a>
  `).join('');
}

function renderEvents(events) {
  const box = document.getElementById('events-list');
  if (!box) return;
  
  if (!events || events.length === 0) {
    box.innerHTML = '<div class="muted">No events</div>';
    return;
  }
  
  box.innerHTML = events.map(ev => `
    <a href="/event-info/?community=${COMMUNITY_ID}#${ev.id}" class="event-item">
      <svg class="item-icon" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 10h5v5H7z"/>
      </svg>
      <span>${ev.name}</span>
    </a>
  `).join('');
}

function updateSidebarLinks() {
  document.getElementById('eventInfoLink').href = `/event-info/?community=${COMMUNITY_ID}`;
  document.getElementById('feedsLink').href = `/feeds/?community=${COMMUNITY_ID}`;
  document.getElementById('membersLink').href = `/members/?community=${COMMUNITY_ID}`;
}

function navigateToCommunity(communityId) {
  window.location.href = `/about/?community=${communityId}`;
}

// ===== Initialize =====
async function init() {
  try {
    await Promise.all([
      fetchCommunityDetails(),
      fetchAllCommunities(),
      fetchChannels(),
      fetchEvents()
    ]);
  } catch (error) {
    console.error('Initialization error:', error);
  }
}

// Close modals on outside click
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('modal-overlay')) {
    e.target.classList.remove('active');
  }
});

// Start the app
init();
</script>
</body>
</html>